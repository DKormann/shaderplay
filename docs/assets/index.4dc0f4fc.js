var M=Object.defineProperty;var A=(s,e,r)=>e in s?M(s,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[e]=r;var p=(s,e,r)=>(A(s,typeof e!="symbol"?e+"":e,r),r);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const t of n)if(t.type==="childList")for(const a of t.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function r(n){const t={};return n.integrity&&(t.integrity=n.integrity),n.referrerpolicy&&(t.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?t.credentials="include":n.crossorigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function i(n){if(n.ep)return;n.ep=!0;const t=r(n);fetch(n.href,t)}})();const L=(s,e,r,i)=>{const n=document.createElement(s);return n.innerText=e,r&&n.classList.add(...r.split(".").filter(t=>t)),i&&Object.entries(i).forEach(([t,a])=>{t==="children"?a.forEach(l=>n.appendChild(l)):t==="eventListeners"?Object.entries(a).forEach(([l,c])=>{n.addEventListener(l,c)}):t==="color"||t==="background"?n.style[t]=a:n[t]=a}),n};let j=0;const y=(s,e=null)=>{if(e==null&&(e=b(s)),typeof s=="number"&&(s={op:"const",value:s,vectype:1,srcs:[]}),s.vectype==e)return s;if(s.vectype!=1)throw new Error("upcast not implemented for dtype "+e);if(typeof s.op!="string")throw new Error("upcast not implemented for "+s);return{op:"vec",srcs:Array.from({length:e},()=>s),vectype:e}},b=s=>typeof s=="number"?1:s.vectype,S=s=>{const e=Math.max(...s.map(b));return{srcs:s.map(r=>y(r,e)),vectype:e}},O=s=>s instanceof u?s.ast:y(s);class u{constructor(e,r="vec"){p(this,"ast");p(this,"vectype");p(this,"inputs",new Set);e instanceof Array||(e=[e]);let i=e.map(O);if(e.forEach(n=>{n instanceof u&&n.inputs.forEach(t=>this.inputs.add(t))}),r=="vec")if(i.length==1)this.ast=i[0];else{let n=i.reduce((t,a)=>t+a.vectype,0);this.ast={op:r,srcs:i,vectype:n}}else{let{srcs:n,vectype:t}=S(i);this.ast={op:r,srcs:n,vectype:t}}if(this.vectype=this.ast.vectype,isNaN(this.ast.vectype))throw new Error("vector must have 1,2,3 or 4 components");if(this.ast.vectype==null)throw new Error("vector must have 1,2,3 or 4 components");if(typeof this.ast.op!="string")throw new Error("wrong ast type")}sin(){return new u([this],"sin")}cos(){return new u([this],"cos")}tan(){return new u([this],"tan")}log(){return new u([this],"log")}exp(){return new u([this],"exp")}add(e){return new u([this,e],"add")}sub(e){return new u([this,e],"sub")}mul(e){return new u([this,e],"mul")}div(e){return new u([this,e],"div")}pow(e){return new u([this,e],"pow")}atan(e){return new u([this,e],"atan")}clamp(e,r){return new u([this,e,r],"clamp")}static fromAst(e,r){let i=new u(e);return r.forEach(n=>i.inputs.add(n)),i}getter(e){if(e>=this.vectype)throw new Error("index out of bounds");return u.fromAst({op:"index",srcs:[this.ast],value:e,vectype:1},this.inputs)}x(){return this.getter(0)}y(){return this.getter(1)}z(){return this.getter(2)}w(){return this.getter(3)}length(){return this.square().sum().sqrt()}normalize(){return this.div(this.length())}sum(){let e=this.getter(0);for(let r=1;r<this.vectype;r++)e=e.add(this.getter(r));return e}sqrt(){return this.pow(.5)}square(){return this.pow(2)}inv(){return this.pow(-1)}tanh(){return this.div(this.add(1).exp().add(1).exp().inv())}}const q=s=>{const e=new Map,r=[];function i(n){if(e.has(n)){let c=e.get(n);return c.usecount+=1,c}const t=n.srcs.map(i),a=n.op=="varying"||n.op=="uniform"?n.name:"x"+r.length,l={ast:n,srcs:t,name:a,usecount:1};return r.push(l),e.set(n,l),l}return i(s),r};class d extends u{constructor(r){const i="input"+j++;super({op:"uniform",vectype:r,srcs:[],name:i});p(this,"value");p(this,"subscribers",new Set);p(this,"name");this.inputs.add(this),this.name=i,this.value=Array.from({length:r},()=>0)}set(...r){if(r.length!=this.vectype)throw new Error("Input.set: wrong number of arguments");this.value=r,this.subscribers.forEach(i=>i(r))}subscribe(r){r(this.value),this.subscribers.add(r)}get(){return this.value}update(r){this.set(r(this.get))}}const N=(s,e)=>new u({op:"varying",name:s,vectype:e,srcs:[]}),g=N("pos",2);new d(1);const E=s=>{let e=q(s.ast);function r(t){return t.ast.op=="uniform"?i(t):t.name}function i(t){const a=t.ast.op,l=t.srcs.map(r),c=o=>{let m=[];if(t.ast.vectype==1)return o(l);for(let w=0;w<t.ast.vectype;w++)m.push(o(l.map(x=>`${x}[${w}]`)));return`[${m.join(",")}]`},h=o=>c(m=>o+"("+m.join(",")+")");switch(a){case"uniform":case"varying":return t.name;case"const":return t.ast.value.toString();case"vec":return`[${t.srcs.map(i).join(",")}]`;case"index":return`${i(t.srcs[0])}[${t.ast.value}]`;case"add":return c(o=>o.join(" + "));case"mul":return c(o=>o.join(" * "));case"sub":return c(o=>`(${o[0]} - ${o[1]})`);case"div":return c(o=>`(${o[0]} / ${o[1]})`);case"pow":return c(o=>`(${o[0]} ** ${o[1]})`);case"atan":return h("Math.atan2");case"sin":return h("Math.sin");case"cos":return h("Math.cos");case"tan":return h("Math.tan");case"log":return h("Math.log");case"exp":return h("Math.exp");case"clamp":return c(o=>`Math.min(Math.max(${o[0]}, ${o[1]}), ${o[2]})`);default:throw new Error("JSCompiler: unknown op "+a)}}return"  "+e.map(t=>["uniform","varying","const"].includes(t.ast.op)?"":`const ${t.name} = ${i(t)};
  `).join("")+"return "+e[e.length-1].name},P=s=>e=>new Function("pos",...Array.from(s.inputs).map(r=>r.name),E(s));document.body.appendChild(L("p","USE ARROW KEYS","",{class:"glcanvas"}));let f=new d(1),C=new d(1),R=new d(1),I=g.length(),J=g.x().atan(g.y()).add(C);f.mul(5).sin().mul(.2);let z=J.mul(10).sin(),F=I.log().sub(R).mul(10).sin();z.mul(F);let v=new u([f,f,f.add(.5)]);v=v.sin();const $=new u([1,2]).add(1).add(f);console.log(E($));console.log(P($));
