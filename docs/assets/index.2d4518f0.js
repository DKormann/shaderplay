var k=Object.defineProperty;var q=(i,e,r)=>e in i?k(i,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):i[e]=r;var v=(i,e,r)=>(q(i,typeof e!="symbol"?e+"":e,r),r);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))t(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&t(s)}).observe(document,{childList:!0,subtree:!0});function r(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerpolicy&&(o.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?o.credentials="include":n.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function t(n){if(n.ep)return;n.ep=!0;const o=r(n);fetch(n.href,o)}})();const O=(i,e,r,t)=>{const n=document.createElement(i);return n.innerText=e,r&&n.classList.add(...r.split(".").filter(o=>o)),t&&Object.entries(t).forEach(([o,s])=>{o==="children"?s.forEach(a=>n.appendChild(a)):o==="eventListeners"?Object.entries(s).forEach(([a,c])=>{n.addEventListener(a,c)}):o==="color"||o==="background"?n.style[o]=s:n[o]=s}),n};let N=0;const B=(i,e)=>{if(i.vectype==e)return i;if(i.vectype!=1)throw new Error("upcast not implemented for dtype "+i.vectype+" to "+e);return{op:"vec",srcs:Array.from({length:e},()=>i),vectype:e}},D=i=>{const e=Math.max(...i.map(r=>r.vectype));return{srcs:i.map(r=>B(r,e)),vectype:e}};class U{constructor(e){return new Proxy(this,{get(t,n){if(typeof n=="string"){const o=Array.from(n).map(s=>s.charCodeAt(0)-"x".charCodeAt(0)).filter(s=>s>=0&&s<4).map(s=>e.get(s));return p(...o)}}})}}const p=(...i)=>A(i),A=i=>{if(i instanceof Array){let e=i.map(A),r=e.reduce((n,o)=>n+o.vectype,0);if(r>4)throw new Error("gather: too many or too big vectors: "+e.map(n=>n.vectype).join(","));if(e.length==1)return e[0];let t=new m({op:"vec",srcs:e.map(n=>n.ast),vectype:r});return e.forEach(n=>n.parents.forEach(o=>t.parents.add(o))),t}return i instanceof m?i:(typeof i=="number"&&(i={op:"const",value:i,vectype:1,srcs:[]}),new m(i))};class m{constructor(e){v(this,"ast");v(this,"vectype");v(this,"parents");v(this,"onclick");v(this,"fields");this.ast=e,this.vectype=e.vectype,this.fields=new U(this),this.parents=new Set([this])}static fromVecs(e,r){const{srcs:t,vectype:n}=D(e.map(s=>s.ast));let o=new m({op:r,srcs:t,vectype:n});return e.forEach(s=>s.parents.forEach(a=>o.parents.add(a))),o}static from(e,r){const t=e.map(A);return m.fromVecs(t,r)}sin(){return m.from([this],"sin")}cos(){return m.from([this],"cos")}tan(){return m.from([this],"tan")}log(){return m.from([this],"log")}exp(){return m.from([this],"exp")}add(...e){return m.from([this,e],"add")}sub(...e){return m.from([this,e],"sub")}mul(...e){return m.from([this,e],"mul")}lt(...e){return m.from([this,e],"lt")}div(...e){return m.from([this,e],"div")}mod(...e){return m.from([this,e],"mod")}pow(e){return m.from([this,e],"pow")}atan(...e){return m.from([this,e],"atan")}clamp(e,r){return m.from([this,e,r],"clamp")}dot(e){return this.mul(e).sum()}abs(){return this.square().sqrt()}mix(e,r){let t=this.clamp(0,1);return t.mul(e).add(A(1).sub(t).mul(r))}where(e,r){return this.lt(0).mix(r,e)}get(e){if(e>=this.vectype)throw new Error("index out of bounds");let r=new m({op:"index",srcs:[this.ast],value:e,vectype:1});return this.parents.forEach(t=>r.parents.add(t)),r}length(){return this.square().sum().sqrt()}normalize(){return this.div(this.length())}reduce(e){let r=this.get(0);for(let t=1;t<this.vectype;t++)r=e(r,this.get(t));return r}gt(e){return this.lt(e).complement()}maximum(e){let r=this.lt(e);return r.mul(e).add(p(1).sub(r).mul(this))}minimum(e){return this.inv().maximum(p(e).inv()).inv()}complement(){return p(1).sub(this)}sum(){return this.reduce((e,r)=>e.add(r))}prod(){return this.reduce((e,r)=>e.mul(r))}max(){return this.reduce((e,r)=>e.maximum(r))}min(){return this.reduce((e,r)=>e.minimum(r))}sqrt(){return this.pow(.5)}square(){return this.pow(2)}inv(){return this.pow(-1)}neg(){return this.mul(-1)}sub1(){return p(1).sub(this)}tanh(){let e=this.exp(),r=e.inv();return e.sub(r).div(e.add(r))}atanh(){return this.add(1).div(this.sub1()).log().mul(.5)}sigmoid(){return this.neg().exp().add(1).inv()}compute(e=[0,0]){return J(this)(e)}frac(){return this.mod(1)}floor(){return this.sub(this.frac())}steps(e){return this.mul(e).floor().div(e)}}const j=i=>{const e=new Map,r=[];function t(n){if(e.has(n)){let c=e.get(n);return c.usecount+=1,c}const o=n.srcs.map(t),s=n.op=="varying"||n.op=="uniform"?n.name:"x"+r.length,a={ast:n,srcs:o,name:s,usecount:1};return r.push(a),e.set(n,a),a}return t(i),r},z=i=>{function e(t){return t.ast.op=="const"||t.usecount<=1?r(t):t.name}function r(t){const n=t.ast.op;if(n=="uniform"||n=="varying")return t.name;if(n=="const"){let a=t.ast.value.toString();return a.includes(".")||(a+=".0"),a}const o=["float","vec2","vec3","vec4"][t.ast.vectype-1];if(n=="vec")return`${o}(${t.srcs.map(a=>e(a)).join(",")})`;if(n=="index")return`${e(t.srcs[0])}.${["x","y","z","w"][t.ast.value]}`;if(n=="add")return`(${e(t.srcs[0])} + ${e(t.srcs[1])})`;if(n=="sub")return`(${e(t.srcs[0])} - ${e(t.srcs[1])})`;if(n=="mul")return`(${e(t.srcs[0])} * ${e(t.srcs[1])})`;if(n=="div")return`(${e(t.srcs[0])} / ${e(t.srcs[1])})`;if(n=="mod")return`mod(${e(t.srcs[0])}, ${e(t.srcs[1])})`;if(n=="lt")return s((a,c)=>`${a} < ${c} ? 1.0 : 0.0`);function s(a){const[c,d]=t.srcs.map(e);if(t.srcs[0].ast.vectype==1)return`(${a(c,d)})`;const u=[];for(let h=0;h<t.srcs[0].ast.vectype;h++){const l=["x","y","z","w"][h];u.push(`${a(`${c}.${l}`,`${d}.${l}`)}`)}return`${o}(${u.join(", ")})`}return`${n}(${t.srcs.map(a=>e(a)).join(", ")})`}return i.map(t=>["uniform","varying","const"].includes(t.ast.op)||t.usecount<=1?"":`${["float","vec2","vec3","vec4"][t.ast.vectype-1]} ${t.name} = ${r(t)};
`).join("")+"gl_FragColor = "+r(i[i.length-1])+";"};class M extends m{constructor(r){const t="input"+N++;super({op:"uniform",vectype:r,srcs:[],name:t});v(this,"value");v(this,"subscribers",new Set);v(this,"name");this.name=t,this.value=Array.from({length:r},()=>0)}set(...r){if(r.length!=this.vectype)throw new Error("Input.set: wrong number of arguments");this.value=r,this.subscribers.forEach(t=>t(r))}subscribe(r){r(this.value),this.subscribers.add(r)}update(r){this.set(...r(this.value))}}const G=(i,e)=>new m({op:"varying",name:i,vectype:e,srcs:[]}),H=G("gl_FragCoord",4),E=new M(2),W=i=>{let e=j(i.ast);function r(o){return o.ast.op=="uniform"?o.name:o.ast.op=="const"?o.ast.value.toString():o.name}function t(o){const s=o.ast.op,a=o.srcs.map(r),c=u=>{let h=[];if(o.ast.vectype==1)return u(a);for(let l=0;l<o.ast.vectype;l++)h.push(u(a.map(w=>`${w}[${l}]`)));return`[${h.join(",")}]`},d=u=>c(h=>u+"("+h.join(",")+")");switch(s){case"uniform":case"varying":return o.name;case"const":return o.ast.value.toString();case"vec":return`[${a.join(",")}].flat()`;case"index":return`${t(o.srcs[0])}[${o.ast.value}]`;case"add":return c(u=>u.join(" + "));case"mul":return c(u=>u.join(" * "));case"sub":return c(u=>`(${u[0]} - ${u[1]})`);case"div":return c(u=>`(${u[0]} / ${u[1]})`);case"mod":return c(u=>`(${u[0]} % ${u[1]})`);case"pow":return c(u=>`(${u[0]} ** ${u[1]})`);case"lt":return c(u=>`(${u[0]} < ${u[1]} ? 1. : 0.)`);case"atan":return d("Math.atan2");case"sin":return d("Math.sin");case"cos":return d("Math.cos");case"tan":return d("Math.tan");case"log":return d("Math.log");case"exp":return d("Math.exp");case"clamp":return c(u=>`Math.min(Math.max(${u[0]}, ${u[1]}), ${u[2]})`);default:throw new Error("JSCompiler: unknown op "+s)}}return"  "+e.map(o=>["uniform","varying","const"].includes(o.ast.op)?"":`const ${o.name} = ${t(o)};
  `).join("")+"return "+e[e.length-1].name},J=i=>{let e=Array.from(i.parents).filter(t=>t.ast.op=="uniform");const r=new Function("gl_FragCoord",...Array.from(e).map(t=>t.name),W(i));return t=>r(t,...Array.from(e).map(n=>n.value))};class X{constructor(e,r){v(this,"gl");v(this,"canvas");let t=p(...e);t.vectype==1&&(t=p(t,t,t)),t.vectype==2&&(t=p(t,0)),t.vectype==3&&(t=p(t,1)),r.addEventListener("click",s=>{let a=r.clientHeight-s.offsetY,c=s.offsetX;console.log(`canvas position [${[c,a]}]`),t.parents.forEach(d=>{d.onclick&&console.log(`${d.onclick} = [${d.compute([c,a])}]`)})});const n=j(t.ast),o=Array.from(t.parents).filter(s=>s.ast.op=="uniform");{const s=r.getContext("webgl2");if(!s)throw new Error("webgl not suppported");this.gl=s,this.canvas=r;const a=(b,$)=>{const g=s.createShader($);if(s.shaderSource(g,b),s.compileShader(g),!s.getShaderParameter(g,s.COMPILE_STATUS))throw new Error(s.getShaderInfoLog(g));return g},c=`
      attribute vec2 a_position;
      void main() {
        gl_Position = vec4(a_position, 0, 1);
      }`,d=`
precision mediump float;
${o.map(b=>`uniform ${["float","vec2","vec3","vec4"][b.ast.vectype-1]} ${b.name};`).join(`
`)}



void main() {

${z(n)}

}`,u=a(c,s.VERTEX_SHADER),h=a(d,s.FRAGMENT_SHADER),l=s.createProgram();if(s.attachShader(l,u),s.attachShader(l,h),s.linkProgram(l),!s.getProgramParameter(l,s.LINK_STATUS))throw new Error(s.getProgramInfoLog(l));s.useProgram(l);const w=s.getAttribLocation(l,"a_position"),T=s.createBuffer();s.bindBuffer(s.ARRAY_BUFFER,T),s.bufferData(s.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,1,1]),s.STATIC_DRAW),s.enableVertexAttribArray(w),s.vertexAttribPointer(w,2,s.FLOAT,!1,0,0),o.forEach(b=>{const $=b.ast,g=s.getUniformLocation(l,$.name);b.subscribe(x=>{$.vectype==1?s.uniform1f(g,...x):$.vectype==2?s.uniform2f(g,...x):$.vectype==3?s.uniform3f(g,...x):s.uniform4f(g,...x)})})}}render(){E.set(this.canvas.width,this.canvas.height),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4)}}function Y(...i){let e="";const r=O("canvas","","",{class:"glcanvas"});r.width=L?window.innerWidth:500,r.height=L?window.innerHeight:500,r.addEventListener("touchstart",t=>{e=t.touches[0].clientX<r.width/2?"ArrowLeft":"ArrowRight",y.set(e,!0)}),r.addEventListener("touchend",t=>{y.set(e,!1)}),document.body.appendChild(r),C.push(new X(i,r))}let C=[];const L=!!navigator.userAgent.match(/(iPhone|iPod|iPad|Android|BlackBerry|IEMobile)/);let f=H.fields.xy,P=new M(1),R=new M(2),F=f.div(E).mul(2);F=F.get(0);const K=i=>i.add(2.4).mul(435.23).sin().mul(34).abs().frac();{let i=f.mul(2).sub(E).div(E.min());f=p(i.fields.x.atan(i.fields.y.neg()),i.length().log());let e=f.add(0,.3).div(.2),r=e.length(),t=r.sub1().mul(100).sigmoid(),n=r.square().mul(2).sub(1).clamp(-.999,.999).atanh().neg(),o=e.fields.x.atan(e.fields.y);f=t.mix(p(o,n),f),f=f.add(R),f=p(f.fields.x.mod(2*Math.PI),f.fields.y);let s=f.fields.x.div(3.1415*2);for(let l=0;l<6;l++){let w=1.8**l;s=s.add(f.fields.y.mul(w*.2).frac().sub(.5).abs().div(w*2))}let a=p(s.mod(1),f.fields.y.sub(P));const c=32;a=a.mul(c,.5).add(0,a.fields.x.steps(c).mul(5.34)),a=a.abs().frac().mul(2).sub(1).abs().sub1().mul(1,2).clamp(0,1).square().prod().mul(K(a.floor().mul(12.3,4.1).sum()).lt(.1));for(let l=1;l<6;l++)f=f.add(f.fields.yx.mul(p(4,3).add(l)).sin().div(l*2)).add(P.mul(.2,.1).mul(l+.4).sin().div(l+2.3));let d=f.fields.x.add(p(0,1,4)).sin().add(p(2,2,3)).normalize(),u=f.fields.y.sub(R.fields.y).add(1).sigmoid();u.onclick="dim";let h=a.mix([1,.2,.2],d.mul(u));Y(h)}const y=new Map;document.addEventListener("keydown",i=>{i.key.startsWith("Arrow")&&i.preventDefault(),y.set(i.key,!0)});document.addEventListener("keyup",i=>y.set(i.key,!1));const S=Math.PI*2;function I(i){var n,o,s,a;let e=0;P.update(c=>(i*=.001,e=i-c[0],[i]));let r=((n=y.get("ArrowRight"))!=null&&n?1:0)-((o=y.get("ArrowLeft"))!=null&&o?1:0),t=((s=y.get("ArrowDown"))!=null&&s?1:0)-((a=y.get("ArrowUp"))!=null&&a?1:0);R.update(c=>[((c[0]+e*r*1)%S+S)%S,c[1]+e*(t+(L?-1:0))]),C.forEach(c=>c.render()),requestAnimationFrame(I)}I(0);
