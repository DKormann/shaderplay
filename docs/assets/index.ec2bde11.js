var K=Object.defineProperty;var W=(n,e,r)=>e in n?K(n,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[e]=r;var i=(n,e,r)=>(W(n,typeof e!="symbol"?e+"":e,r),r);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))t(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&t(l)}).observe(document,{childList:!0,subtree:!0});function r(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerpolicy&&(o.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?o.credentials="include":s.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function t(s){if(s.ep)return;s.ep=!0;const o=r(s);fetch(s.href,o)}})();const N=(n,e,r,t)=>{const s=document.createElement(n);return s.innerText=e,r&&s.classList.add(...r.split(".").filter(o=>o)),t&&Object.entries(t).forEach(([o,l])=>{o==="children"?l.forEach(a=>s.appendChild(a)):o==="eventListeners"?Object.entries(l).forEach(([a,h])=>{s.addEventListener(a,h)}):o==="color"||o==="background"?s.style[o]=l:s[o]=l}),s};let I=0;class S{constructor(e){i(this,"size");this.size=e}toString(){return this.size==1?"float":"vec"+this.size}choose(...e){return e[this.size-1]}eq(e){return this.size==e.size}}const p=new S(1),T=new S(2),B=new S(3),M=new S(4);class q{constructor(e=null,r=p){i(this,"name");i(this,"dtype");i(this,"add",this.app_binary(b("+")));i(this,"sub",this.app_binary(b("-")));i(this,"mul",this.app_binary(b("*")));i(this,"div",this.app_binary(b("/")));i(this,"sin",this.app_unary(E("sin")));i(this,"cos",this.app_unary(E("cos")));i(this,"log",this.app_unary(E("log")));i(this,"pow",this.app_binary(U("pow")));i(this,"atan",this.app_binary(U("atan")));i(this,"clamp",(e,r)=>new y([this,e,r],J("clamp")));i(this,"x",()=>v("x",this));i(this,"y",()=>v("y",this));i(this,"z",()=>v("z",this));i(this,"w",()=>v("w",this));e==null&&(e="x"+String(I),I+=1),this.name=e,this.dtype=r}gen(){return this.name}compile(e){e.varmap.has(this.name)||e.varmap.set(this.name,this)}toString(){return"AST"}app_binary(e){return r=>new y([this,r],e)}app_unary(e){return()=>new y([this],e)}sum(){let e=this.x();for(let r=1;r<this.dtype.size;r++)e=e.add([this.x,this.y,this.z,this.w][r]());return e}sqrt(){return this.pow(.5)}length(){return this.mul(this).sum().sqrt()}normalize(){return this.div(this.length())}}const Y=n=>new d(-1,(...e)=>`${n}(${e.map(r=>r.name).join(",")})`),g=n=>{let e=n.map(s=>typeof s=="number"?X(s,p):s).reduce((s,o)=>s+o.dtype.size,0);if(e>4)throw new Error("too many args");const r=[p,T,B,M][e-1],t=new y(n,Y(r));return t.dtype=r,t},X=(n,e=p)=>{if(typeof n=="number"&&(n=new A(n)),n.dtype==e)return n;if(n.dtype!=p)throw new Error("cant upcast:"+n.dtype+"->"+e);return g(Array.from({length:e.size},(r,t)=>n))};class d{constructor(e,r){i(this,"arity");i(this,"gen");this.arity=e,this.gen=(...t)=>r(...t.map(s=>typeof s=="number"?new A(s):s))}toString(){return this.gen(...Array.from({length:this.arity},(e,r)=>new A(r)))}}function b(n){return new d(2,(e,r)=>`${e.name} ${n} ${r.name}`)}function E(n){return new d(1,e=>`${n}(${e.name})`)}function U(n){return new d(2,(e,r)=>`${n}(${e.name}, ${r.name})`)}function J(n){return new d(3,(e,r,t)=>`${n}(${e.name}, ${r.name}, ${t.name})`)}function v(n,e){if(["x","y","z","w"].indexOf(n)>e.dtype.size-1)throw new Error("field out of bounds");const t=new d(1,o=>`${o.name}.${n}`),s=new y([e],t);return s.dtype=p,s}class A extends q{constructor(r){let t=`${r}`;t.includes(".")||(t+=".");super(t,p);i(this,"value");this.value=r*1}compile(r){}gen(){return this.name}}class y extends q{constructor(r,t,s=null,o=null){let l=r.map(a=>typeof a=="number"?new A(a):a);o==null&&(o=l.map(a=>a.dtype).reduce((a,h)=>a.size>h.size?a:h,p));super(s,o);i(this,"srcs");i(this,"op");this.srcs=l,this.op=t}gen(){return this.op.gen(...this.srcs)}compile(r){this.srcs.forEach(t=>t.compile(r)),super.compile(r)}}class R extends y{constructor(r=null,t=p){super([],new d(0,()=>"name"),r,t);i(this,"setValue",r=>{})}compile(r){r.uniforms.set(this.name,this)}}class Q extends R{compile(e){}}const L=new Q("pos",T);class Z{constructor(e,r){i(this,"varmap",new Map);i(this,"uniforms",new Map);i(this,"graph");i(this,"gl");if(e.dtype!=M)throw`frag shader must result in vec4 got ${e.dtype}`;e.compile(this),this.varmap.delete(e.name),this.graph=e;{const t=r.getContext("webgl");if(!t)throw new Error("webgl not suppported");this.gl=t;const s=(c,f)=>{const u=t.createShader(f);if(t.shaderSource(u,c),t.compileShader(u),!t.getShaderParameter(u,t.COMPILE_STATUS))throw new Error(t.getShaderInfoLog(u));return u},o=`
      attribute vec2 a_position;
      varying vec2 pos;
      void main() {
        pos = a_position;
        gl_Position = vec4(a_position, 0, 1);
      }`,l=`
precision mediump float;
varying vec2 pos;
${Array.from(this.uniforms.values()).map(c=>`uniform ${c.dtype} ${c.name};`).join(`
`)}

void main() {
  ${Array.from(this.varmap.values()).map(c=>`${c.dtype} ${c.name} = ${c.gen()};`).join(`
  `)}
  gl_FragColor = ${this.graph.gen()};
}`,a=s(o,t.VERTEX_SHADER),h=s(l,t.FRAGMENT_SHADER),m=t.createProgram();if(t.attachShader(m,a),t.attachShader(m,h),t.linkProgram(m),!t.getProgramParameter(m,t.LINK_STATUS))throw new Error(t.getProgramInfoLog(m));t.useProgram(m);const O=t.getAttribLocation(m,"a_position"),H=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,H),t.bufferData(t.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,1,1]),t.STATIC_DRAW),t.enableVertexAttribArray(O),t.vertexAttribPointer(O,2,t.FLOAT,!1,0,0),this.uniforms.forEach(c=>{const f=t.getUniformLocation(m,c.name);c.setValue=(...u)=>{c.dtype==p?t.uniform1f(f,...u):c.dtype==T?t.uniform2f(f,...u):c.dtype==B?t.uniform3f(f,...u):t.uniform4f(f,...u)}})}}render(){this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4)}}document.body.appendChild(N("p","USE ARROW BUTTONS",""));const _=N("canvas","","",{id:"glcanvas"});document.body.appendChild(_);_.width=500;_.height=500;const j=n=>n.x().pow(2).add(n.y().pow(2)).pow(.5),ee=(n,e,r)=>(n=n.clamp(0,1),e.mul(te.sub(n)).add(r.mul(n))),te=new A(1),P=new R,D=new R;let G=L.x().atan(L.y().mul(-1)),F=j(L).log().mul(-1),re=G.add(D.mul(.5)).mul(5).sin().mul(F.mul(5).add(P.mul(5)).sin()).clamp(0,1),z=g([1,3,6]).add(P.mul(2)).add(F.mul(.1)).sin().mul(re),ne=g([F,G]);const se=j(ne.sub(g([.5,0]))).mul(-8).add(2).clamp(0,1);z=ee(se,z,g([1,0,0]));const oe=new Z(g([z,1]),_);let $=0;const w=new Map;document.body.addEventListener("keydown",n=>{w.set(n.key,!0)});document.body.addEventListener("keyup",n=>{w.set(n.key,!1)});let V=0,x=1,C=0;function k(n){var r,t,s;let e=V-n;V=n,(r=w.get("ArrowUp"))!=null&&r&&(x+=.2),x*=.95,C+=e*(x+1),(t=w.get("ArrowLeft"))!=null&&t?$+=.1:(s=w.get("ArrowRight"))!=null&&s&&($-=.1),P.setValue(-C*.001),D.setValue($),oe.render(),requestAnimationFrame(k)}requestAnimationFrame(k);
